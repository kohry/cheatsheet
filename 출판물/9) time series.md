# 시계열분석

시계열 분석은 시간이라는 중요한 요소가 들어가는 데이터입니다. 
주식 자동매매등의 프로그램등은 이러한 시계열 분석을 이용하여 매매를 하는데, 따라서 상당히 재미있는 분석방법입니다.

시계열은 시간이 흐를수록 변동하는 데이터에 대한 분석입니다. 다만 몇가지 단어는 별게 아닌데 괜시리 어려운 해석체여서 바로 감이 오지 않는 경우가 있습니다.


## 관련패키지

xts, zoo, TTR

## 자기회귀 (AR, Autoregressive)

자기회귀란 말이 잘 와닫지는 않지만, 주식시장을 한번 생각해보면 쉽습니다. 엄청나게 단기에 떨어지면 다시 쑥 가격이 회복되는 경우가 있습니다.
흔들흔들 하다가 자신이 원래 가야갈 길로 정신을 차리고 회귀한다는 뜻으로 생각하면 됩니다. 

## 이동평균 (MA, Moving Average)
상승추세, 하락추세라는 말로 개미들을 살살 꾀는 세력이라는 말을 들어본적이 있나요? 단기적으로는 요동쳐도 장기적으로는 추세대로 간다는 시장을 생각해보면 됩니다.
흔들흔들해도 장기적으로는 어떠한 추세를 가지고 따라간다는 것으로 생각하면 됩니다.

## 시계열 차분 해보기

```
kings <- scan("http://robjhyndman.com/tsdldata/misc/kings.dat",skip=3)
plot.ts(kings)
```

<<<그래프>>>

데이터 자체가 평균이 일정치 않으면 차분이라는것을 합니다. 차분이라는 단어가 별것이 있어 보이지만 정말 별게 아니고, 전 데이터와 차이를 구하는 겁니다.
예를들어 1번차분을 한다고 하면, 시간 1번뒤의 데이터와의 차이만큼을 계산하는겁니다.

그렇다면 차분한 데이터는 정상적일까요?

```
df <- diff(kings, differences=1)
plot.ts(df)
```

적당히 안정적인것 같습니다. 즉, 분산과 평균이 시간에 따라 왔다갔다 하지 않는것을 확인한겁니다.

## ACF, PACF

ACF는 AutoCorrelation Function 이며, PACF의 P는 Partial을 뜻합니다.
ACF는 실제로 해당하는 시간의 데이터가 뒤의 데이터들과 얼마나 상관이 있는지 나타내는 함수입니다. 
예를들어, 어떠한 시간에 가격이 만원이 형성되어있고 이같은 가격이 계속 상승해왔으면 아무래도 전 데이터와 강력한 상관관계가 있을겁니다. 오늘의 주식가격은 어제의 주식가격과 강력한 상관관계도 있고, 위력이 떨어지기는 하지만 5일전의 주식가격과도 어느정도 상관관계가 있을수 있기 때문입니다. 

acf()함수를 살펴보면 이를 확인할수 있습니다.

```
acf(df)
```

만약 상관관계가 있었다면, 그래프는 천천히 떨어지는 형상을 보여야 하는데 이런경우는 그렇지는 않습니다.

PACF는 변수들의 상관관계를 설명하고도 남아있는 상관이며, 정확히 시점만큼 떨어져 있는 데이터들의 상관입니다. ACF는 트렌드를 확인하는데, PACF는 자기회귀계수를 확인하는데 유용하게 쓰입니다.

```
pacf(df)
```

<<<그래프>>>

## 시차상관 알아내기
예를들어 가상통화의 가격은 한국이 주도한다고 칩시다. 그렇지만 이를 확인하고 싶으면 실제로 미국의 가격과 한국의 -1 시간의 가격과 상관이 높으면 그렇다고 확인할수 있습니다.

```
test1 <- c(1,2,3,4,5,6,6,6)
test2 <- c(2,3,4,5,6,6,6,6)
ccf(test1,test2)
```

<<<<<그래프>>>>>


## arima모형 알아내기

ACF와 PACF를 이용해 절단점을 알아내고 어떤 모형을 써야하는지 알아낼수도 있지만 이를 자동적으로 하는것도 가능합니다.

```
library(forecast)
auto.arima(df)

Series: df 
ARIMA(0,0,1) with zero mean 

Coefficients:
          ma1
      -0.7218
s.e.   0.1208

sigma^2 estimated as 236.2:  log likelihood=-170.06
AIC=344.13   AICc=344.44   BIC=347.56
```

### arima로 예측하기

```
m <- arima(df, order=c(2,1,2))
predict(m)

$pred
Time Series:
Start = 42 
End = 42 
Frequency = 1 
[1] 10.59924

$se
Time Series:
Start = 42 
End = 42 
Frequency = 1 
[1] 15.42431
```

```
predict(m, n.ahead=10)

$pred
Time Series:
Start = 42 
End = 51 
Frequency = 1 
 [1] 10.5992408  3.9087927 -1.4707307 -0.2878669  0.6276717  0.4187722  0.2630061  0.2998605
 [9]  0.3263535  0.3198579

$se
Time Series:
Start = 42 
End = 51 
Frequency = 1 
 [1] 15.42431 17.86829 18.03205 18.11407 18.12239 18.12238 18.12198 18.12241 18.12250 18.12244
```

